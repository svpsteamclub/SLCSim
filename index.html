<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Robot Seguidor de Línea</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="simulation-area">
            <canvas id="simulationCanvas"></canvas>
        </div>

        <div class="controls-area">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="openTab(event, 'robotConfig')">Robot</button>
                <button class="tab-button" onclick="openTab(event, 'trackConfig')">Pista</button>
                <button class="tab-button" onclick="openTab(event, 'logicConfig')">Lógica (Arduino)</button>
            </div>

            <!-- Pestaña Configuración Robot -->
            <div id="robotConfig" class="tab-content active">
                <h3>Configuración del Robot</h3>
                <label for="numSensors">Número de Sensores:</label>
                <input type="number" id="numSensors" value="5" min="1" max="10">
                <label for="sensorSpacing">Espaciado entre Sensores (px):</label>
                <input type="number" id="sensorSpacing" value="10" min="1">
                <label for="sensorOffset">Distancia Sensores al Eje (px):</label>
                <input type="number" id="sensorOffset" value="15" min="0">
                <label for="robotSpeed">Velocidad Máxima (px/ciclo):</label>
                <input type="number" id="robotSpeed" value="2" min="0.1" step="0.1">
                <!-- Más opciones: color del robot, dimensiones, etc. -->
            </div>

            <!-- Pestaña Configuración Pista -->
            <div id="trackConfig" class="tab-content">
                <h3>Configuración de la Pista</h3>
                <button id="drawTrackButton">Dibujar Pista Manualmente</button>
                <button id="loadPresetTrackButton">Cargar Pista Predefinida</button>
                <label for="trackColor">Color de Línea:</label>
                <input type="color" id="trackColor" value="#000000">
                <label for="bgColor">Color de Fondo:</label>
                <input type="color" id="bgColor" value="#FFFFFF">
                <label for="lineWidth">Ancho de Línea (px):</label>
                <input type="number" id="lineWidth" value="10" min="1">
                <!-- Opciones para cargar/guardar pistas -->
            </div>

            <!-- Pestaña Configuración Lógica -->
            <div id="logicConfig" class="tab-content">
                <h3>Lógica del Robot (Estilo Arduino)</h3>
                <p>Define tu función <code>loop()</code>. Puedes usar: <br>
                   <code>readSensor(index)</code>: devuelve 0 (blanco) o 1 (línea). <br>
                   <code>motor(leftSpeed, rightSpeed)</code>: -1 a 1 para cada motor.
                </p>
                <textarea id="robotLogicCode" rows="15" cols="50">
// Ejemplo: Lógica simple proporcional
function loop() {
    let s0 = readSensor(0); // Izquierdo
    let s1 = readSensor(1);
    let s2 = readSensor(2); // Centro
    let s3 = readSensor(3);
    let s4 = readSensor(4); // Derecho

    let error = 0;
    // Esta lógica es muy básica, mejorarla es parte del reto
    if (s0 === 1 && s1 === 0) error = -2;
    else if (s1 === 1 && s2 === 0) error = -1;
    else if (s2 === 1) error = 0; // Idealmente, este es el único activo
    else if (s3 === 1 && s2 === 0) error = 1;
    else if (s4 === 1 && s3 === 0) error = 2;
    else if (s0===0 && s1===0 && s2===0 && s3===0 && s4===0) {
        // Se perdió la línea, intentar girar o usar última dirección conocida
        // Por ahora, parar o seguir recto (depende de la última acción)
    }


    const Kp = 0.4; // Constante proporcional
    let correction = Kp * error;

    let baseSpeed = 0.7; // Velocidad base

    motor(baseSpeed - correction, baseSpeed + correction);
}
                </textarea>
            </div>

            <div class="simulation-controls">
                <button id="startButton">Iniciar</button>
                <button id="stopButton">Detener</button>
                <button id="resetButton">Reiniciar</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>